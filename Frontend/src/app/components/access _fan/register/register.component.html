<div class="registration-container" *ngIf="!registrationComplete">
  <!-- Header -->
  <div class="registration-header">
    <h1 class="header-title">¡Unite al Club!</h1>
    <p class="header-subtitle">Completa tu registro y formá parte de nuestra gran familia</p>
  </div>

  <!-- Progress -->
  <div class="progress-container">
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1" id="step1">
        <div class="step-number">1</div>
        <div class="step-label">Datos Personales</div>
        <div class="step-connector"></div>
      </div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2" id="step2">
        <div class="step-number">2</div>
        <div class="step-label">Información Adicional</div>
        <div class="step-connector"></div>
      </div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3" id="step3">
        <div class="step-number">3</div>
        <div class="step-label">Método de Pago</div>
      </div>
    </div>
    <div class="progress-bar-custom">
      <div class="progress-fill" id="progressFill" [style.width.%]="progressPercentage"></div>
    </div>
  </div>

  <!-- Form -->
  <div class="form-container">
    <form [formGroup]="registrationForm" (ngSubmit)="submitForm()" novalidate>
      
      <!-- Step 1: Datos Personales -->
      <div class="form-step" [class.active]="currentStep === 1" *ngIf="currentStep === 1">
        <h2 class="step-title">Datos Personales</h2>
        <p class="step-description">Completá tus datos básicos para comenzar el registro</p>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Nombre <span class="required">*</span></label>
              <input
                type="text"
                class="form-control"
                [class.is-invalid]="isFieldInvalid('firstName')"
                formControlName="firstName"
                placeholder="Ingresa tu nombre">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('firstName')">
                {{ getFieldErrorMessage('firstName') }}
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Apellido <span class="required">*</span></label>
              <input
                type="text"
                class="form-control"
                [class.is-invalid]="isFieldInvalid('lastName')"
                formControlName="lastName"
                placeholder="Ingresa tu apellido">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('lastName')">
                {{ getFieldErrorMessage('lastName') }}
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Fecha de Nacimiento <span class="required">*</span></label>
              <input
                type="date"
                class="form-control"
                [class.is-invalid]="isFieldInvalid('birthDate')"
                formControlName="birthDate">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('birthDate')">
                {{ getFieldErrorMessage('birthDate') }}
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">DNI/Documento <span class="required">*</span></label>
              <input
                type="text"
                class="form-control"
                [class.is-invalid]="isFieldInvalid('document')"
                formControlName="document"
                placeholder="12345678">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('document')">
                {{ getFieldErrorMessage('document') }}
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Correo Electrónico <span class="required">*</span></label>
          <input
            type="email"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('email')"
            formControlName="email"
            placeholder="tu@email.com">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('email')">
            {{ getFieldErrorMessage('email') }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Contraseña <span class="required">*</span></label>
          <input
            type="password"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('password')"
            formControlName="password"
            placeholder="Mínimo 8 caracteres">
          <small class="form-text text-muted">Mínimo 8 caracteres</small>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('password')">
            {{ getFieldErrorMessage('password') }}
          </div>
        </div>
      </div>

      <!-- Step 2: Información Adicional -->
      <div class="form-step" [class.active]="currentStep === 2" *ngIf="currentStep === 2">
        <h2 class="step-title">Información Adicional</h2>
        <p class="step-description">Agregá algunos datos más para completar tu perfil</p>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Ciudad <span class="required">*</span></label>
              <input
                type="text"
                class="form-control"
                [class.is-invalid]="isFieldInvalid('city')"
                formControlName="city"
                placeholder="Tu ciudad">
              <div class="invalid-feedback" *ngIf="isFieldInvalid('city')">
                {{ getFieldErrorMessage('city') }}
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Provincia <span class="required">*</span></label>
              <select
                class="form-select"
                [class.is-invalid]="isFieldInvalid('province')"
                formControlName="province">
                <option value="">Seleccionar provincia</option>
                <option *ngFor="let province of provinces" [value]="province">
                  {{ province }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('province')">
                {{ getFieldErrorMessage('province') }}
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Dirección Completa <span class="required">*</span></label>
          <input
            type="text"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('address')"
            formControlName="address"
            placeholder="Calle, número, barrio">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('address')">
            {{ getFieldErrorMessage('address') }}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Teléfono</label>
              <input
                type="tel"
                class="form-control"
                formControlName="phone"
                placeholder="+54 9 11 1234-5678">
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Ocupación</label>
              <input
                type="text"
                class="form-control"
                formControlName="occupation"
                placeholder="Tu ocupación">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">¿Cómo conociste el club?</label>
          <select class="form-select" formControlName="howKnowClub">
            <option value="">Seleccionar opción</option>
            <option *ngFor="let option of howKnowOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- Step 3: Método de Pago -->
      <div class="form-step" [class.active]="currentStep === 3" *ngIf="currentStep === 3">
        <h2 class="step-title">Método de Pago</h2>
        <p class="step-description">Elegí cómo querés realizar el pago de tu cuota social</p>

        <div class="summary-section">
          <h4 class="summary-title">Resumen de Membresía</h4>
          <div class="summary-item">
            <span class="summary-label">Cuota de Ingreso:</span>
            <span class="summary-value">$15.000</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Cuota Mensual:</span>
            <span class="summary-value">$8.500</span>
          </div>
          <hr>
          <div class="summary-item">
            <span class="summary-label"><strong>Total Inicial:</strong></span>
            <span class="summary-value"><strong>$23.500</strong></span>
          </div>
        </div>

        <div class="payment-options">
          <div 
            class="payment-option" 
            [class.selected]="selectedPaymentMethod === 'presencial'"
            (click)="selectPaymentMethod('presencial')"
            data-payment="presencial">
            <div class="payment-icon">
              <i class="fas fa-building"></i>
            </div>
            <h4 class="payment-title">Pago Presencial</h4>
            <p class="payment-description">Visitá nuestras oficinas para realizar el pago en efectivo o con tarjeta</p>
          </div>
          <div 
            class="payment-option" 
            [class.selected]="selectedPaymentMethod === 'mercadopago'"
            (click)="selectPaymentMethod('mercadopago')"
            data-payment="mercadopago">
            <div class="payment-icon">
              <i class="fas fa-credit-card"></i>
            </div>
            <h4 class="payment-title">Mercado Pago</h4>
            <p class="payment-description">Pagá online de forma segura con tarjeta o transferencia</p>
          </div>
        </div>

        <div class="mercadopago-options" [class.show]="showMercadopagoOptions" *ngIf="showMercadopagoOptions">
          <h5 style="margin-bottom: 1rem; color: var(--dark-bg); font-weight: 700;">Opciones de Mercado Pago</h5>
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="radio" 
              formControlName="mercadopagoType"
              id="subscription" 
              value="subscription">
            <label class="form-check-label" for="subscription">
              <strong>Suscripción Automática</strong>
              <small class="d-block text-muted">Se debitará automáticamente cada mes</small>
            </label>
          </div>
          <div class="form-check">
            <input 
              class="form-check-input" 
              type="radio" 
              formControlName="mercadopagoType"
              id="manual" 
              value="manual">
            <label class="form-check-label" for="manual">
              <strong>Pago Manual</strong>
              <small class="d-block text-muted">Realizarás el pago manualmente cada mes</small>
            </label>
          </div>
        </div>

        <div class="form-check" style="margin-top: 2rem;">
          <input 
            class="form-check-input" 
            type="checkbox" 
            [class.is-invalid]="isFieldInvalid('acceptTerms')"
            formControlName="acceptTerms"
            id="acceptTerms">
          <label class="form-check-label" for="acceptTerms">
            Acepto los <a href="#" style="color: var(--principal);">términos y condiciones</a> y el 
            <a href="#" style="color: var(--principal);">reglamento del club</a> 
            <span class="required">*</span>
          </label>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('acceptTerms')">
            {{ getFieldErrorMessage('acceptTerms') }}
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="form-navigation">
        <button 
          type="button" 
          class="btn-custom btn-secondary-custom" 
          *ngIf="!isFirstStep"
          (click)="prevStep()"
          [disabled]="isSubmitting">
          <i class="fas fa-arrow-left"></i> Anterior
        </button>
        <div *ngIf="isFirstStep"></div>
        
        <button 
          type="button" 
          class="btn-custom btn-primary-custom" 
          (click)="nextStep()"
          [disabled]="isSubmitting">
          <span *ngIf="!isSubmitting">
            {{ nextButtonText }} <i [class]="nextButtonIcon"></i>
          </span>
          <span *ngIf="isSubmitting">
            <i class="fas fa-spinner fa-spin"></i> Enviando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Success Message -->
<div class="registration-container" *ngIf="registrationComplete">
  <div class="registration-header">
    <h1 class="header-title">¡Registro Completado!</h1>
    <p class="header-subtitle">Tu solicitud ha sido procesada exitosamente</p>
  </div>
  
  <div class="form-container">
    <div class="success-message">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2 class="success-title">¡Bienvenido al Club!</h2>
      <p class="success-description">
        Tu solicitud de registro ha sido enviada correctamente.
        En breve recibirás un correo con los próximos pasos a seguir y la información
        sobre cómo completar tu pago.
      </p>
      <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
        <button 
          type="button" 
          class="btn-custom btn-secondary-custom" 
          (click)="resetForm()">
          Nuevo Registro
        </button>
        <button 
          type="button" 
          class="btn-custom btn-primary-custom" 
          (click)="goHome()">
          Volver al Inicio
        </button>
      </div>
    </div>
  </div>
</div>